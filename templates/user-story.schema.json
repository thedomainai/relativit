{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "UserStory",
  "type": "object",
  "required": ["id", "title", "as_a", "i_want", "so_that"],
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^US-[0-9]{4}$",
      "description": "Unique user story identifier (e.g., US-0001)"
    },
    "title": {
      "type": "string",
      "minLength": 5,
      "maxLength": 100,
      "description": "Brief title of the user story"
    },
    "as_a": {
      "type": "string",
      "description": "User role or persona (As a...)"
    },
    "i_want": {
      "type": "string",
      "description": "Desired functionality (I want...)"
    },
    "so_that": {
      "type": "string",
      "description": "Business value or benefit (So that...)"
    },
    "priority": {
      "type": "string",
      "enum": ["critical", "high", "medium", "low"],
      "default": "medium",
      "description": "Priority level"
    },
    "status": {
      "type": "string",
      "enum": ["draft", "ready", "in_progress", "blocked", "completed", "rejected"],
      "default": "draft",
      "description": "Current status"
    },
    "epic": {
      "type": "string",
      "description": "Parent epic or feature area"
    },
    "acceptance_criteria": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["given", "when", "then"],
        "properties": {
          "given": {
            "type": "string",
            "description": "Initial context or precondition"
          },
          "when": {
            "type": "string",
            "description": "Action or event"
          },
          "then": {
            "type": "string",
            "description": "Expected outcome"
          }
        }
      },
      "minItems": 1,
      "description": "Acceptance criteria in Given-When-Then format"
    },
    "story_points": {
      "type": "integer",
      "minimum": 1,
      "maximum": 21,
      "description": "Estimated effort (Fibonacci: 1,2,3,5,8,13,21)"
    },
    "dependencies": {
      "type": "array",
      "items": {
        "type": "string",
        "pattern": "^US-[0-9]{4}$"
      },
      "description": "IDs of dependent user stories"
    },
    "related_requirements": {
      "type": "array",
      "items": {
        "type": "string",
        "pattern": "^REQ-[0-9]{4}$"
      },
      "description": "Generated or related requirement IDs"
    },
    "persona": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "description": "Persona name"
        },
        "role": {
          "type": "string",
          "description": "User role"
        },
        "goals": {
          "type": "array",
          "items": {"type": "string"},
          "description": "User goals"
        },
        "pain_points": {
          "type": "array",
          "items": {"type": "string"},
          "description": "User pain points"
        }
      }
    },
    "conversation": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "role": {
            "type": "string",
            "enum": ["user", "stakeholder", "developer", "ai_agent"]
          },
          "message": {
            "type": "string"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "description": "Conversation history about this story"
    },
    "mockups": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "enum": ["wireframe", "mockup", "prototype", "screenshot"]
          },
          "url": {
            "type": "string",
            "format": "uri"
          },
          "description": {
            "type": "string"
          }
        }
      },
      "description": "Visual mockups or wireframes"
    },
    "ui_references": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["name", "url", "reference_points"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Name of the reference (e.g., 'Notion - Sidebar Navigation')"
          },
          "url": {
            "type": "string",
            "format": "uri",
            "description": "URL of the reference site"
          },
          "reference_points": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "minItems": 1,
            "description": "Specific UI/UX aspects to reference"
          },
          "screenshots": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "url": {
                  "type": "string"
                },
                "description": {
                  "type": "string"
                }
              }
            },
            "description": "Screenshots highlighting the reference points"
          },
          "what_to_adopt": {
            "type": "string",
            "description": "What specific elements or patterns to adopt"
          },
          "notes": {
            "type": "string",
            "description": "Additional notes about this reference"
          }
        }
      },
      "description": "UI/UX design references for this story"
    },
    "tags": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Tags for categorization"
    },
    "notes": {
      "type": "string",
      "description": "Additional notes or context"
    },
    "metadata": {
      "type": "object",
      "properties": {
        "created_at": {
          "type": "string",
          "format": "date-time"
        },
        "updated_at": {
          "type": "string",
          "format": "date-time"
        },
        "created_by": {
          "type": "string",
          "description": "Creator (user, ai_agent, stakeholder)"
        },
        "sprint": {
          "type": "string",
          "description": "Sprint or iteration"
        },
        "team": {
          "type": "string",
          "description": "Assigned team"
        },
        "confidence_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "AI confidence in story quality"
        }
      }
    }
  }
}
